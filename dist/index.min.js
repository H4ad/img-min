const html=String.raw,getImgScaleUrl=({url:t,width:e,quality:i,format:s})=>`https://img-scale.now.sh?format=${s}&width=${e}&quality=${i}&url=${encodeURIComponent(t)}`;window.ImgMin={};const getUrl=({format:t,url:e,width:i,quality:s,isPreview:r})=>{const o=window.ImgMin.getCDNUrl||getImgScaleUrl;return r&&(i/=7),`${o({url:e,width:i=(i=Math.floor(i))>50?i-i%30:i-i%5,quality:s,format:t})} 1x,${o({url:e,width:Math.floor(1.1*i),quality:Math.min(Math.floor(1.1*s),100),format:t})} 2x, ${o({url:e,width:Math.floor(1.3*i),quality:Math.min(Math.floor(1.3*s),100),format:t})} 3x`};let active,invisibles=[];const onScroll=()=>{!active&&invisibles.length>0&&(active=!0,setTimeout(()=>{invisibles.forEach(t=>t.checkVisibility()),invisibles=invisibles.filter(t=>!t.visible),active=!1},200))},template=html`
  <picture>
    <source type="image/webp" />
    <source type="image/jpeg" />
    <img part="img" />
  </picture>
  <style>
    picture,
    img {
      display: block;
      width: 100%;
    }

    picture {
      overflow: hidden;
      position: relative;
      padding-bottom: calc(100% / (var(--aspect-ratio)));
    }
    img {
      position: absolute;
      opacity: 0;
      top: 0;
      left: 0;
      height: 100%;
      filter: blur(var(--preview-blur));
      transform: scale3d(1.1, 1.1, 1);
      transition: all 0.7s ease-in-out;
    }
    :host {
      display: block;
      background: #f4f4f4;
    }

    :host([loaded]) {
    }

    :host([preview]) img {
      opacity: 1;
    }

    :host([loaded]) img {
      opacity: 1;
      filter: blur(0px);
      transform: translateZ(0) scale3d(1, 1, 1);
    }
  </style>
`;let postponed=[];const pending={};let initOnce,isWebpSupported;const init=async()=>{document.addEventListener("scroll",onScroll),isWebpSupported=await testIsWebpSupported()},testIsWebpSupported=async()=>{if(!createImageBitmap)return!1;const t=await fetch("data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAEAAQAcJaQAA3AA/v3AgAA=").then(t=>t.blob());return createImageBitmap(t).then(()=>!0,()=>!1)};customElements.define("img-min",class extends HTMLElement{constructor(){super(),initOnce||(initOnce=!0,init()),this.maxWidth=0;const t=this.attachShadow({mode:"open"});t.innerHTML=template,this.picture=t.querySelector("picture"),this.img=this.shadowRoot.querySelector("img");const e=()=>{this.removeAttribute("preview"),this.setAttribute("loaded",""),this.img.onload=null};this.img.onload=(()=>{if(delete pending[this.src],this.setAttribute("preview",""),this.isFirefox)return this.removeAttribute("preview"),this.setAttribute("loaded",""),void(this.img.onload=null);this.isPreview=!1,this.img.onload=e,postponed.push(()=>this.resize()),0===Object.keys(pending).length&&(postponed.reverse().forEach(t=>t()),postponed=[])}),this.resize=this.resize.bind(this),addEventListener("resize",this.resize),invisibles.push(this)}static get observedAttributes(){return["src","quality"]}get src(){return this.getAttribute("src")}get quality(){return parseInt(this.getAttribute("quality"),10)||50}set quality(t){this.setAttribute("quality",t),this.updateSrcset()}set src(t){this.setAttribute("src",t),this.updateSrcset()}attributeChangedCallback(t,e,i){e!==i&&(this[t]=i)}getSrcset(t){return getUrl({url:this.src,format:t,width:this.width,height:this.height,quality:this.quality,isPreview:this.isPreview})}updateSrcset(){this.visible&&(isWebpSupported?(this.webp=this.webp||this.shadowRoot.querySelector('source[type="image/webp"]'),this.webp.srcset=this.getSrcset("webp")):(this.jpeg=this.jpeg||this.shadowRoot.querySelector('source[type="image/jpeg"]'),this.jpeg.srcset=this.getSrcset("jpeg")))}get width(){return this._width}set width(t){this._width=t,this.updateSrcset()}disconnectedCallback(){removeEventListener("resize",this.resize)}loadPreview(t){this.isPreview=!this.isFirefox,pending[this.src]=!0,this.width=t}checkVisibility(){const t=parseInt(this.getAttribute("lazy-dist"))||100,{top:e,bottom:i,width:s,height:r}=this.img.getBoundingClientRect(),o=i<-t,h=e>window.innerHeight+t;o||h||this.visible||(this.visible=!0,this.height=r,this.loadPreview(s))}resize(){this.visible&&(cancelAnimationFrame(this.af),this.af=requestAnimationFrame(()=>{const{width:t,height:e}=this.img.getBoundingClientRect();t>this.maxWidth&&(this.maxWidth=t,this.height=e,this.width=t)}))}connectedCallback(){this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,this.isFirefox&&this.img.style.setProperty("transition-property","opacity");const{width:t,height:e}=this.img.getBoundingClientRect();this.img.style.setProperty("--preview-blur",`${Math.floor(t/18)}px`),0===e&&(console.warn("img-min: element has height=0 and will never be visible",this),console.warn("img-min: it is recommend to use --aspect-ratio to all images")),setTimeout(()=>{this.checkVisibility()},50)}});